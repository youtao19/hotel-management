# “修改订单”功能优化需求

根据您的要求，我理解的“修改订单”功能优化需求如下：

## 核心目标

重构“修改订单”弹窗，使其不再是完全自由的编辑模式，而是基于已生成的“订单账单”来展示核心财务信息，并限制日期的修改，以确保数据的一致性。

## 具体实现方案

### 后端 (Backend)

1.  **新增 API 接口**:
    *   在 `backend/routes/billRoute.js` 中，增加一个新的 GET 接口：`/api/bills/order/:orderId/details`。
    *   这个接口将专门用于获取指定 `orderId` 的所有 `change_type` 为 `'订单账单'` 的账单记录。

2.  **新增业务逻辑**:
    *   在 `backend/modules/billModule.js` 中，添加一个新的函数，例如 `getOrderBillDetails(orderId)`。
    *   该函数将查询 `bills` 表，返回一个订单所有关联的“订单账单”列表，按日期 (`stay_date`) 排序。

### 前端 (Frontend)

1.  **数据获取**:
    *   在 `src/components/ChangeOrderDialog.vue` 组件中，当弹窗显示时，会调用新的后端接口 (`/api/bills/order/:orderId/details`) 来获取当前订单的账单详情。

2.  **界面展示与交互**:
    *   **房费显示**: 弹窗将不再显示一个总的房费输入框，而是会列表展示从后端获取的每一笔“订单账单”的房费金额 (`room_fee`) 和对应的日期 (`stay_date`)。
    *   **押金显示**: 弹窗会显示一个“押金”字段，其值将来源于“订单账单”中的押金 (`deposit`) 金额。
    *   **日期不可修改**: “入住日期”和“离店日期”这两个输入框将被设置为**只读**，用户将不能通过此弹窗修改订单的日期。
    *   其他信息（如客人姓名、电话、备注等）将保持可编辑状态。

## 总结

总的来说，修改后的逻辑将从数据库的 `bills` 表中读取 `change_type` 为 `'订单账单'` 的记录，并将这些记录中的房费和押金信息展示在前端“修改订单”弹窗中，同时禁止用户修改订单日期。

---

我将等待您的确认指令“执行修改”后再开始进行代码的修改。
